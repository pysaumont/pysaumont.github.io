<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Recursive lambdas in Java 8</title>
    <meta name="description" content="" />
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:300,400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="//fpinjava.github.io/themes/Saga/assets/css/style.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="//fpinjava.github.io/themes/Saga/assets/css/animate.min.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="//fpinjava.github.io/themes/Saga/favicon.ico" rel="shortcut icon">
    <link rel="canonical" href="https://fpinjava.github.io/2014/09/01/Recursive-lambdas-in-Java-8.html" />
    
    <meta property="og:site_name" content="Functional Programming in Java" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Recursive lambdas in Java 8" />
    <meta property="og:description" content="Many Java programmers believe that is is not possible to create recursive lambdas. This is simply not true. One question that comes back often about Java 8 lambdas is &quot;Can they be recursive?&quot;. The most current answer is simply no,..." />
    <meta property="og:url" content="https://fpinjava.github.io/2014/09/01/Recursive-lambdas-in-Java-8.html" />
    <meta property="article:published_time" content="2014-08-31T22:00:00.000Z" />
    <meta property="article:modified_time" content="2015-10-15T15:50:37.814Z" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Recursive lambdas in Java 8" />
    <meta name="twitter:description" content="Many Java programmers believe that is is not possible to create recursive lambdas. This is simply not true. One question that comes back often about Java 8 lambdas is &quot;Can they be recursive?&quot;. The most current answer is simply no,..." />
    <meta name="twitter:url" content="https://fpinjava.github.io/2014/09/01/Recursive-lambdas-in-Java-8.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Functional Programming in Java",
    "author": {
        "@type": "Person",
        "name": null,
        "image": "https://avatars.githubusercontent.com/u/10783533?v=3",
        "url": "undefined/author/undefined",
        "sameAs": null
    },
    "headline": "Recursive lambdas in Java 8",
    "url": "https://fpinjava.github.io/2014/09/01/Recursive-lambdas-in-Java-8.html",
    "datePublished": "2014-08-31T22:00:00.000Z",
    "dateModified": "2015-10-15T15:50:37.814Z",
    "description": "Many Java programmers believe that is is not possible to create recursive lambdas. This is simply not true. One question that comes back often about Java 8 lambdas is &quot;Can they be recursive?&quot;. The most current answer is simply no,..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Functional Programming in Java" href="https://fpinjava.github.io/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template">
    <header id="header" class="animated fadeIn">
    <div class="header-background">
    <section class="blog-content">
        <a id="site-url" class="blog-title" href="https://fpinjava.github.io">Functional Programming in Java</a>
        <span class="blog-description">This is the blog associated with my book &quot;Functional Programming in Java&quot;, published by Manning (https://manning.com/books/functional-programming-in-java). 

Functional Programming is not tied to any &quot;functional&quot; language. It is a way of thinking and a paradigm for writing programs. Some languages are more &quot;functional friendly&quot;, and if you intend to write program using the functional paradigm,  you should probably pick one of them... if you can. This blog (and the associated book) is dedicated to those who can&#x27;t.</span>
        <nav class="links fadeIn animated">
            <ul>
                <!-- <li class="rss"><a title="RSS Feed" href="/rss/"><i class="fa fa-fw fa-rss-square"></i></a></li> -->
        
            </ul>
        </nav>
    </section>
    <section class="header-content">
        <h1 class="post-title animated fadeInUp">Recursive lambdas in Java 8</h1>
        <span class="post-data"><span class="date animated fadeInUp"><i class="fa fa-clock-o"></i> <time class="timesince date" data-timesince="1409522400" datetime="2014-09-01T00:00" title="01 September 2014">2014-09-01 00:00:00<ago class="ago"></time></span>
            
            <span class="author animated fadeInUp"><i class="fa fa-user"></i> <a href=""></a></span></span>
    </section>
    </div>
</header>
<main id="main" class="content">
    <article itemtype="http://schema.org/BlogPosting" class="animated fadeIn content post post">
        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Many Java programmers believe that is is not possible to create recursive lambdas. This is simply not true.</p>
</div>
<div class="paragraph">
<p>One question that comes back often about Java 8 lambdas is "Can they be recursive?". The most current answer is simply no, although one may find answers stating that lambdas were once made recursive while Java 8 was in development, but this feature has been removed before the final release.</p>
</div>
<div class="paragraph">
<p>Some may argue that since Java uses stack based recursion, we don&#8217;t need recursive lambdas, since we should not be using recursion at all. However, even without heap based recursion, we can still make efficient use of recursion, as long as the number of recursive steps remains low (typically under 2000). So it could be useful to be able to define recursive lambdas. And anyway, it&#8217;s fun!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_problem_with_anonymous_lambda_based_functions">The problem with anonymous lambda based functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lambdas are most often used to define anonymous functions. A recursive function must call itself. An anonymous lambda can&#8217;t call itself since it has no name, so it can&#8217;t be recursive. However, not all lambdas are anonymous.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_named_lambda_based_functions">Named lambda based functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is of course perfectly possible to name a lambda based function, so we may be tempted to write a recursive factorial function as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Function&lt;Integer, Integer&gt; factorial = x -&gt; x == 1
    ? x
    : x * factorial.apply(x - 1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this will not work and will produce a compiler error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Error:(14, 18) java: self-reference in initializer</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is exactly the same as writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">int x = x + 10;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem here is that we are referencing a variable while initializing it. So it is not yet initialized. There is a solution to this problem. We just have to first declare the variable and later assign a value to it. The variable will be initialized with the default value (0 for an int, null for the factorial function). We can do this in a constructor, or at the moment we first need it (lazy initialization), but the simplest way is to use an initializer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Function&lt;Integer, Integer&gt; factorial;
{
  factorial = x -&gt; x == 1
      ? x
      : x * factorial.apply(x - 1);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need a static function, you may use a <code>static</code> initializer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">static Function&lt;Integer, Integer&gt; factorial;
static {
  factorial = x -&gt; x == 1
      ? x
      : x * factorial.apply(x - 1);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem with this approach is that we can&#8217;t declare the <code>factorial</code> field <code>final</code>. FP programmers love to make everything immutable. Can we do this? Yes, we can! Just use the trick in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final Function&lt;Integer, Integer&gt; factorial = x -&gt; x == 1
      ? x
      : x * this.factorial.apply(x - 1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>By adding <code>this.</code> in front of the function name, we can both declare it as <code>final</code> and initialize it at the same time. If you prefer a <code>static</code> function, just replace <code>this</code> with the name of the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">static final Function&lt;Integer, Integer&gt; factorial = x -&gt; x == 1
      ? x
      : x * MyClass.factorial.apply(x - 1);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beware_of_stack_based_recursion">Beware of stack based recursion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This function uses stack base recursion, which means that every recursive call will push the current state on the stack, which has a very limited size. (The actual size is implementation dependant.) As a result, this program will blow the stack (resulting in a <code>StackOverflowError</code>) if you call the function with a value higher than somewhere between 2_000 an 3_000. So you should not use this kind of recursion in production code unless you are sure that the number of nested calls remains low. By the way, this function will result in an arithmetic overflow for f(18).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_s_next">What&#8217;s next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a next post, we will see how to handle heap based recursion in order to be able to use recursion in production code.</p>
</div>
</div>
</div>
        </section>

    </article>

</main>
    <footer class="animated fadeIn" id="footer">
        <section class="colophon">
          <section class="copyright">Copyright &copy; <span itemprop="copyrightHolder">Functional Programming in Java</span>. <span rel="license">All Rights Reserved</span>.</section>
          <section class="poweredby">Published with <a class="icon-ghost" href="http://hubpress.io">HubPress</a></section>
        </section>
        <section class="bottom">
          <section class="attribution">
            <a href="http://github.com/Reedyn/Saga">Built with <i class="fa fa-heart"></i> and Free and Open-Source Software</a>.
          </section>
        </section>
    </footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>
    <script src="//fpinjava.github.io/themes/Saga/assets/js/scripts.js?v=1.0.0"></script>
    
</body>
</html>
